<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Persona • TVmaze</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="/css/main.css" rel="stylesheet" />
</head>
<body>
  <header class="c-header">
    <div class="c-header__brand"><a href="/">TVmaze App</a></div>
  </header>

  <main class="container">
    <section id="profile" class="section"></section>
    <section class="section">
      <h2 class="section__title">Conocido por</h2>
      <div id="credits" class="c-grid"></div>
    </section>
  </main>

  <script type="module">
    import { $, renderInto, showCard } from "/js/ui.js";
    import { personById, personCredits } from "/js/api.js";

    const id = new URLSearchParams(location.search).get("id");
    renderInto($("#profile"), "<p>Cargando…</p>");

    Promise.all([personById(id), personCredits(id)])
      .then(([personRes, creditsRes])=>{
        const p = personRes.data;
        const img = p.image?.original || p.image?.medium || "";
        renderInto($("#profile"), `
          <div class="row">
            <img src="${img}" alt="${p.name}" style="max-width:220px;border-radius:var(--radius)">
            <div>
              <h1 class="section__title">${p.name}</h1>
              <p class="mt">País: ${p.country?.name || "—"}</p>
              <p>Birthday: ${p.birthday || "—"}</p>
            </div>
          </div>
        `);

        const shows = (creditsRes.data || [])
          .map(c => c._embedded?.show)
          .filter(Boolean);
        const unique = new Map(shows.map(s => [s.id, s]));
        renderInto($("#credits"), [...unique.values()].slice(0,18).map(showCard).join("") || "<p>Sin créditos.</p>");
      })
      .catch(()=> renderInto($("#profile"), "<p>Error cargando persona.</p>"));
  </script>
</body>
</html>
